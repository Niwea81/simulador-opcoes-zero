<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Simulador Educacional de OpÃ§Ãµes</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:#020617;
  color:#e5e7eb;
}
.container{
  max-width:1100px;
  margin:40px auto;
  background:#020024;
  padding:30px;
  border-radius:18px;
}
h1,h2{color:#facc15;text-align:center}
label{display:block;margin-top:14px;font-weight:bold}
input,select{
  width:100%;padding:10px;margin-top:6px;border-radius:6px;border:none
}
button{
  margin-top:25px;width:100%;padding:16px;
  font-size:18px;background:#2563eb;color:#fff;
  border:none;border-radius:10px;cursor:pointer
}
.section{
  margin-top:30px;background:#020617;
  padding:20px;border-radius:14px
}
.alert{background:#1e293b;border-left:4px solid #ef4444;padding:12px;margin-top:12px}
.note{background:#020024;border-left:4px solid #facc15;padding:12px;margin-top:12px}
.tag{padding:6px 12px;border-radius:8px;font-weight:bold}
.green{background:#22c55e;color:#000}
.yellow{background:#facc15;color:#000}
.red{background:#ef4444;color:#fff}
canvas{width:100%;height:260px}
</style>
</head>

<body>
<div class="container">

<h1>ğŸ“Š Simulador Educacional de OpÃ§Ãµes</h1>

<label>Ativo</label>
<select id="ativo">
<option>SPY</option><option>SPX</option><option>XSP</option><option>QQQ</option>
<option>AAPL</option><option>MSFT</option><option>NVDA</option>
<option>AMZN</option><option>GOOGL</option><option>META</option><option>TSLA</option>
</select>

<label>PreÃ§o Atual</label>
<input id="S" type="number" value="100">

<label>Strike</label>
<input id="K" type="number" value="105">

<label>Dias atÃ© o Vencimento</label>
<input id="T" type="number" value="7">

<label>Volatilidade (%)</label>
<input id="vol" type="number" value="20">

<label>Estrutura</label>
<select id="estrutura">
<option value="call_buy">Call Comprada</option>
<option value="put_buy">Put Comprada</option>
<option value="call_sell">Call Vendida (Naked)</option>
<option value="put_sell">Put Vendida (Naked)</option>
<option disabled>â”€â”€â”€â”€â”€â”€â”€â”€</option>
<option value="bull_call">Bull Call Spread</option>
<option value="bear_put">Bear Put Spread</option>
</select>

<div class="alert">
âš ï¸ Vendas de opÃ§Ãµes exigem margem e podem gerar perdas elevadas.
</div>

<div class="note">
ğŸ“Œ Compare sempre com o grÃ¡fico antes de tomar decisÃ£o.
</div>

<button onclick="analisar()">ğŸ“ˆ Analisar</button>

<div id="resultado" class="section"></div>

<div class="section">
<h2>ğŸ“‰ Payoff</h2>
<canvas id="payoff"></canvas>
<div id="payoffMsg"></div>
</div>

<div class="section">
<h2>ğŸ“Š GrÃ¡fico do Ativo</h2>
<iframe id="tv" width="100%" height="420"></iframe>
</div>

</div>

<script>
// ===== util =====
function erf(x){
 const a1=0.254829592,a2=-0.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=0.3275911;
 const s=x<0?-1:1; x=Math.abs(x);
 const t=1/(1+p*x);
 const y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-x*x);
 return s*y;
}
const N=x=>0.5*(1+erf(x/Math.sqrt(2)));

function analisar(){
 try{
 const S=+document.getElementById("S").value;
 const K=+document.getElementById("K").value;
 const T=+document.getElementById("T").value/365;
 const vol=+document.getElementById("vol").value/100;
 const estrutura=document.getElementById("estrutura").value;
 const ativo=document.getElementById("ativo").value;

 const r=0.05;
 const d1=(Math.log(S/K)+(r+0.5*vol*vol)*T)/(vol*Math.sqrt(T));
 const d2=d1-vol*Math.sqrt(T);

 let preco=S*N(d1)-K*Math.exp(-r*T)*N(d2);
 let delta=N(d1);
 let pop=(1-Math.abs(delta))*100;

 let moneyness = S>K?"ITM":(S<K?"OTM":"ATM");

 let perfil="Iniciante", risco="Limitado", tag="green", texto="";

 if(estrutura==="put_buy"){
   preco=K*Math.exp(-r*T)*N(-d2)-S*N(-d1);
   delta=N(d1)-1;
   pop=Math.abs(delta)*100;
   texto="ProteÃ§Ã£o ou direcional de baixa. Perda limitada.";
 }
 if(estrutura.includes("sell")){
   perfil="AvanÃ§ado"; risco="Elevado"; tag="red";
   texto="Venda naked. Saia rÃ¡pido antes que tudo vire merda.";
 }
 if(estrutura.includes("spread")){
   perfil="IntermediÃ¡rio"; risco="Limitado"; tag="yellow";
   texto="Spread vertical com controle de risco.";
   pop=60;
 }

 document.getElementById("resultado").innerHTML=`
 <h2>ğŸ“ AnÃ¡lise</h2>
 <p><b>PreÃ§o TeÃ³rico:</b> $${preco.toFixed(2)}</p>
 <p><b>Delta:</b> ${delta.toFixed(2)}</p>
 <p><b>POP:</b> ${pop.toFixed(0)}%</p>
 <p><b>Moneyness:</b> ${moneyness}</p>
 <p><b>Perfil:</b> <span class="tag ${tag}">${perfil}</span></p>
 <p><b>Risco:</b> ${risco}</p>
 <p>${texto}</p>
 `;

 document.getElementById("tv").src=
 `https://s.tradingview.com/widgetembed/?symbol=${ativo}&interval=60&theme=dark`;

 desenharPayoff(S,K,estrutura);
 }catch(e){
 alert("Erro na anÃ¡lise. Verifique os campos.");
 }
}

const canvas = document.getElementById("payoff");
const ctx = canvas.getContext("2d");

canvas.width = canvas.offsetWidth;
canvas.height = 260;

ctx.clearRect(0, 0, canvas.width, canvas.height);

// Escala simples
const minPrice = S * 0.8;
const maxPrice = S * 1.2;
const range = maxPrice - minPrice;
const scaleX = canvas.width / range;
const scaleY = 4;

// Breakeven educacional (call comprada)
const breakeven = K;

// Linha do payoff
ctx.beginPath();
ctx.strokeStyle = "#22c55e";
ctx.lineWidth = 3;

for (let x = 0; x <= canvas.width; x++) {
  const price = minPrice + (x / canvas.width) * range;
  const payoff = Math.max(price - K, 0);
  const y = canvas.height - payoff * scaleY - 40;

  if (x === 0) ctx.moveTo(x, y);
  else ctx.lineTo(x, y);
}
ctx.stroke();

// FunÃ§Ã£o para desenhar bolinhas
function drawDot(price, color) {
  const payoff = Math.max(price - K, 0);
  const x = (price - minPrice) * scaleX;
  const y = canvas.height - payoff * scaleY - 40;

  ctx.beginPath();
  ctx.arc(x, y, 7, 0, Math.PI * 2);
  ctx.fillStyle = color;
  ctx.fill();
}

// ğŸ”´ Zona de dor
drawDot(K - 10, "#ef4444");

// ğŸŸ¡ Breakeven
drawDot(breakeven, "#facc15");

// ğŸŸ¢ Zona confortÃ¡vel
drawDot(K + 15, "#22c55e");

// Mensagem educativa (mantida simples)
document.getElementById("payoffMsg").innerHTML = `
  <p>ğŸ”´ Abaixo do breakeven: comeÃ§a a dor</p>
  <p>ğŸŸ¡ No breakeven: zona neutra</p>
  <p>ğŸŸ¢ Acima do breakeven: vocÃª fica mais tranquilo</p>
`;

</script>

</body>
</html>
