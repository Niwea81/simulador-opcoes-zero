<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Simulador Educacional de Op√ß√µes</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #020617, #020024);
  color: #e5e7eb;
}
.container {
  max-width: 900px;
  margin: 40px auto;
  background: #020617;
  padding: 30px;
  border-radius: 14px;
}
h1, h2 {
  text-align: center;
  color: #facc15;
}
label {
  display: block;
  margin-top: 12px;
  font-weight: bold;
}
input, select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 6px;
  border: none;
}
button {
  margin-top: 25px;
  width: 100%;
  padding: 14px;
  font-size: 18px;
  background: #2563eb;
  border-radius: 8px;
  border: none;
  color: white;
  cursor: pointer;
}
.section {
  margin-top: 30px;
  padding: 20px;
  background: #020024;
  border-radius: 12px;
}
canvas {
  width: 100%;
  height: 260px;
}
</style>
</head>

<body>

<div class="container">
<h1>üìä Simulador Educacional de Op√ß√µes</h1>

<label>Ativo</label>
<select id="ativo">
  <option>SPY</option>
  <option>SPX</option>
  <option>QQQ</option>
</select>

<label>Pre√ßo Atual</label>
<input id="S" type="number" value="100">

<label>Strike</label>
<input id="K" type="number" value="105">

<label>Dias at√© o Vencimento</label>
<input id="T" type="number" value="7">

<label>Volatilidade (%)</label>
<input id="vol" type="number" value="20">

<label>Tipo de Op√ß√£o</label>
<select id="tipo">
  <option value="call">Call</option>
  <option value="put">Put</option>
</select>

<button onclick="calcular()">üìà Calcular & Analisar</button>

<div id="resultado" class="section"></div>

<div class="section">
  <h2>Payoff</h2>
  <canvas id="payoff"></canvas>
</div>

<div class="section">
  <h2>Gr√°fico do Ativo</h2>
  <iframe id="tv" width="100%" height="400" frameborder="0"></iframe>
</div>

</div>

<script>
function erf(x) {
  const a1 = 0.254829592;
  const a2 = -0.284496736;
  const a3 = 1.421413741;
  const a4 = -1.453152027;
  const a5 = 1.061405429;
  const p = 0.3275911;

  const sign = x < 0 ? -1 : 1;
  x = Math.abs(x);

  const t = 1 / (1 + p * x);
  const y = 1 - (((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-x * x));

  return sign * y;
}

function N(x) {
  return 0.5 * (1 + erf(x / Math.sqrt(2)));
}

function calcular() {
  const S = +document.getElementById("S").value;
  const K = +document.getElementById("K").value;
  const T = document.getElementById("T").value / 365;
  const sigma = document.getElementById("vol").value / 100;
  const tipo = document.getElementById("tipo").value;
  const r = 0.05;

  const d1 = (Math.log(S/K) + (r + 0.5*sigma*sigma)*T) / (sigma*Math.sqrt(T));
  const d2 = d1 - sigma*Math.sqrt(T);

  let preco, delta;

  if (tipo === "call") {
    preco = S*N(d1) - K*Math.exp(-r*T)*N(d2);
    delta = N(d1);
  } else {
    preco = K*Math.exp(-r*T)*N(-d2) - S*N(-d1);
    delta = N(d1) - 1;
  }

  let perfil = "Conservador";
  let zona = "OTM";

  if (Math.abs(delta) > 0.45) {
    perfil = "Agressivo";
    zona = "ITM";
  } else if (Math.abs(delta) > 0.25) {
    perfil = "Moderado";
    zona = "ATM";
  }

  document.getElementById("resultado").innerHTML = `
    <h2>An√°lise Educacional</h2>
    <p><b>Pre√ßo Te√≥rico:</b> $${preco.toFixed(2)}</p>
    <p><b>Delta:</b> ${delta.toFixed(2)}</p>
    <p><b>Moneyness:</b> ${zona}</p>
    <p><b>Perfil:</b> ${perfil}</p>
  `;

  document.getElementById("tv").src =
   `https://s.tradingview.com/widgetembed/?symbol=${document.getElementById("ativo").value}&interval=60&theme=dark`;

  desenharPayoff(S, K, tipo);
}

function desenharPayoff(S, K, tipo) {
  const c = document.getElementById("payoff");
  const ctx = c.getContext("2d");
  c.width = c.offsetWidth;
  c.height = 260;
  ctx.clearRect(0,0,c.width,c.height);

  ctx.beginPath();
  ctx.strokeStyle = "#22c55e";
  ctx.lineWidth = 3;

  for (let x = 0; x <= c.width; x++) {
    const p = S - 30 + (x/c.width)*60;
    let payoff = tipo === "call" ? Math.max(p-K,0) : Math.max(K-p,0);
    const y = c.height - payoff*4 - 40;
    if (x === 0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  }
  ctx.stroke();
}
</script>

</body>
</html>

