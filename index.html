<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Simulador Educacional de Op√ß√µes</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: radial-gradient(circle, #020617, #000);
  color: #e5e7eb;
  margin: 0;
}
.container {
  max-width: 950px;
  margin: 40px auto;
  background: #020617;
  padding: 30px;
  border-radius: 16px;
}
h1, h2 {
  text-align: center;
  color: #facc15;
}
label {
  margin-top: 14px;
  display: block;
  font-weight: bold;
}
input, select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 6px;
  border: none;
}
button {
  margin-top: 25px;
  width: 100%;
  padding: 15px;
  font-size: 18px;
  background: #2563eb;
  border-radius: 10px;
  border: none;
  color: white;
  cursor: pointer;
}
.section {
  margin-top: 30px;
  background: #020024;
  padding: 20px;
  border-radius: 14px;
}
canvas {
  width: 100%;
  height: 260px;
}
.tag {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: bold;
}
.green { background:#22c55e; color:#000; }
.yellow { background:#facc15; color:#000; }
.red { background:#ef4444; color:#fff; }
</style>
</head>

<body>

<div class="container">

<h1>üìä Simulador Educacional de Op√ß√µes</h1>

<label>Ativo</label>
<select id="ativo">
  <option>SPY</option>
  <option>SPX</option>
  <option>QQQ</option>
</select>

<label>Pre√ßo Atual</label>
<input id="S" type="number" value="100">

<label>Strike</label>
<input id="K" type="number" value="105">

<label>Dias at√© o Vencimento</label>
<input id="T" type="number" value="7">

<label>Volatilidade (%)</label>
<input id="vol" type="number" value="20">

<label>Tipo</label>
<select id="tipo">
  <option value="call">Call</option>
  <option value="put">Put</option>
</select>

<button onclick="analisar()">üìà Analisar Cen√°rio</button>

<div id="bs" class="section"></div>
<div id="sugestao" class="section"></div>

<div class="section">
<h2>Payoff</h2>
<canvas id="payoff"></canvas>
</div>

<div class="section">
<h2>Gr√°fico do Ativo</h2>
<iframe id="tv" width="100%" height="400" frameborder="0"></iframe>
</div>

</div>

<script>
// ==== Black-Scholes ==== //
function erf(x) {
  const a1=0.254829592,a2=-0.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=0.3275911;
  const sign=x<0?-1:1; x=Math.abs(x);
  const t=1/(1+p*x);
  const y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-x*x);
  return sign*y;
}
function N(x){ return 0.5*(1+erf(x/Math.sqrt(2))); }

function analisar(){
  const S=+S_el.value,K=+K_el.value,T=+T_el.value/365,œÉ=+vol.value/100;
  const tipo=tipo_el.value,r=0.05;

  const d1=(Math.log(S/K)+(r+0.5*œÉ*œÉ)*T)/(œÉ*Math.sqrt(T));
  const d2=d1-œÉ*Math.sqrt(T);

  let preco,delta;
  if(tipo==="call"){ preco=S*N(d1)-K*Math.exp(-r*T)*N(d2); delta=N(d1); }
  else{ preco=K*Math.exp(-r*T)*N(-d2)-S*N(-d1); delta=N(d1)-1; }

  let moneyness="OTM",perfil="Iniciante",tag="green";
  if(Math.abs(delta)>0.45){ moneyness="ITM"; perfil="Agressivo"; tag="red"; }
  else if(Math.abs(delta)>0.25){ moneyness="ATM"; perfil="Moderado"; tag="yellow"; }

  bs.innerHTML=`
  <h2>üìê Black-Scholes</h2>
  <p><b>Pre√ßo Te√≥rico:</b> $${preco.toFixed(2)}</p>
  <p><b>Delta:</b> ${delta.toFixed(2)}</p>
  <p><b>Classifica√ß√£o:</b> ${moneyness}</p>
  `;

  sugestao.innerHTML=`
  <h2>üß† Sugest√£o Educacional</h2>
  <p class="tag ${tag}">${perfil}</p>
  <p>
  ${perfil==="Iniciante"?
  "Estrutura simples. Prefira op√ß√µes OTM com delta entre 0.15 e 0.25. Risco menor, foco em aprendizado.":
  perfil==="Moderado"?
  "Pode usar op√ß√µes ATM com delta entre 0.30 e 0.45. Equil√≠brio entre risco e resposta ao pre√ßo.":
  "Estrutura agressiva. Op√ß√µes ITM, delta acima de 0.50. Movem r√°pido, exigem disciplina."}
  </p>
  `;

  tv.src=`https://s.tradingview.com/widgetembed/?symbol=${ativo.value}&interval=60&theme=dark`;
  desenharPayoff(S,K,tipo);
}

const S_el=S, K_el=K, T_el=T, tipo_el=tipo;

function desenharPayoff(S,K,tipo){
  const c=payoff,ctx=c.getContext("2d");
  c.width=c.offsetWidth; c.height=260;
  ctx.clearRect(0,0,c.width,c.height);
  ctx.beginPath(); ctx.strokeStyle="#22c55e"; ctx.lineWidth=3;
  for(let x=0;x<=c.width;x++){
    const p=S-30+(x/c.width)*60;
    const pf=tipo==="call"?Math.max(p-K,0):Math.max(K-p,0);
    const y=c.height-pf*4-40;
    if(x===0)ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.stroke();
}
</script>

</body>
</html>
